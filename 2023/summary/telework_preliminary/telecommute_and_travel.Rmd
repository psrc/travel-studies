---
title: "telecommute_july23_travel"
author: "suzanne"
date: "2024-07-17"
output: html_document
---
run telecommue_july23 first
for telecommuters vs not;
number of trips by type 
mode
distance traveled

```{r setup, include=FALSE}
library(data.table)
library(stringr)
library(travelSurveyTools)
library(psrcelmer)
library(dplyr)
library(psrcplot)
library(tidyverse)
library(forcats)
source('survey-23-preprocess.R')
```

```{r setup, include=FALSE}
library(data.table)

variable_list<-add_variable(variable_list, 'mode_char1','trip')
group_labels<-get_grouped_labels(group_id='group_1', group_name='mode_char1')
value_labels<-add_values_code(group_name='mode_char1')
trip<-grp_to_tbl(tbl=trip, ungrouped_name='mode_characterization', grouped_name='mode_char1')%>%filter(mode_characterization!='Airplane')

variable_list<-add_variable(variable_list, 'dest_purpose_simple','trip')
group_labels<-get_grouped_labels(group_id='group_1', group_name='dest_purpose_simple')
value_labels<-add_values_code(group_name='dest_purpose_simple')
trip<-grp_to_tbl(tbl=trip, ungrouped_name='dest_purpose', grouped_name='dest_purpose_simple')
```

```{r}
trip<-data.table(trip)
hh_23<-hh%>%filter(survey_year=='2023')
workers_23<-workers%>%filter(survey_year=='2023')
person_23<-person%>%filter(survey_year=='2023')
day_23<-day%>%filter(survey_year=='2023')
trip_23<-trip%>%filter(survey_year=='2023')
hh_data_23<-
  list(hh=hh_23, person=workers_23, day=day_23, trip=trip_23)

ids = c('hh_id', 'person_id', 'day_id', 'trip_id')
wts = c('hh_weight', 'person_weight', 'day_weight', 'trip_weight')
```

```{r}
#some how a duplicate snuck into the variable list not sure how
variable_list<-variable_list%>%distinct(variable, .keep_all=TRUE)
```


```{r}
triprate_prep<-hts_prep_triprate(summarize_by = c('dest_purpose_simple', 'telecommute_status'),
                    variables_dt = variable_list,
                    hts_data = hh_data_23,
                    ids = ids,
                    wts = wts,
                    weighted = TRUE,
                    remove_outliers=FALSE)


```

```{r}
output <- hts_summary(triprate_prep$num,
                       summarize_var = 'num_trips_wtd',
                       summarize_by = c('dest_purpose_simple', 'telecommute_status'),
                       summarize_vartype = 'numeric',
                       id_cols = ids,
                       wtname = 'day_weight',
                       se=TRUE )
```
## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}

output_trips<-output$summary$wtd
                                                                                                   
static<-static_column_chart(output_trips, y='mean', x='dest_purpose_simple', fill='telecommute_status') + theme(axis.text.x=element_text(size=16), axis.text.y=element_text(size=16),legend.text = element_text(size=16), axis.title.y=element_text(size=20), axis.title.x=element_text(size=20))

static

write.csv(output_trips,'telecommute_summary_trips.csv')

```

## Including Plots

You can also embed plots, for example:

```{r}
telecommute_mode<- summarize_weighted(hts_data= hh_data_23,
                               summarize_var = 'mode_characterization',
                               summarize_by = c('telecommute_status'),
                               id_cols=ids,
                               wt_cols=wts,
                               wtname= 'trip_weight'
                               )

```
```{r}

telecommute_mode<-telecommute_mode$summary$wtd%>%filter(mode_characterization %in% c('Transit', 'Walk', 'Bike/Micromobility'))%>%mutate(telecommute_status=factor(telecommute_status, levels=c('Fully In Person', 'Hybrid', 'Fully At Home')))%>%mutate(mode_characterization=fct_reorder(mode_characterization, prop))
                                                                                                   
static<-static_column_chart(telecommute_mode, y='prop', x='mode_characterization', fill='telecommute_status') + theme(axis.text.x=element_text(size=16), axis.text.y=element_text(size=16),legend.text = element_text(size=16), axis.title.y=element_text(size=20), axis.title.x=element_text(size=20))+
   scale_y_continuous(labels = scales::percent_format(scale = 100), limits=c(0,.20))

static

write.csv(telecommute_mode, 'telecommute_summary_mode.csv')

```
