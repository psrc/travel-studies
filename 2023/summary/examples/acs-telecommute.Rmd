---
title: "second-example"
author: "suzanne"
date: "2024-03-27"
output: html_document
---



```{r setup, include=FALSE}
library(data.table)
library(stringr)
library(travelSurveyTools)
library(psrcelmer)
library(dplyr)
library(psrcplot)
library(tidyverse)
source('survey-23-preprocess.R')
```

```{r}

acs_commute_mode_data<-read_rds('C:/GitHub/acs-mode-share/data/commute_data.rds')
```


the demographic variables for the base analysis should come from ACS
: household income, gender, race and ethnicity, occupation, age group
```{r}
work_at_home_share<- acs_commute_mode_data%>%filter(geography=='Region' &  metric=='Commute Mode' )
```

```{r}
static_line_chart(t=work_at_home_share, x='year', y='share', fill='variable' )
```
`
## Visualize
```{r}

workplace_summary<-workplace$summary$wtd%>%filter(workplace== 'At home (telecommute or self-employed with home office)')
static_column_chart(workplace_summary, y='prop', x='workplace', fill='survey_year', xlabel='Worker share who ONLY work at home')

```
# to do: generalize, functionalize, just making it work for now;
```{r}
# make a generalized dataframe to store the outputs



summary_out<-workplace_summary%>%
        mutate(var_1_value=survey_year, var_1_name= 'survey_year',
         var_2_value= workplace, var_2_name= 'workplace')%>%
         select(-c(survey_year, workplace))%>%mutate(geography='regional')



```

```{r}
workplace_summary_21_23<-workplace$summary$wtd%>%filter(survey_year %in% c('2021', '2023'))
static_bar_chart(workplace_summary_21_23, x='prop', y='workplace', fill='survey_year')

```




2023 only by gender
```{r}
workers_23<-workers%>%filter(survey_year =='2023')
hh_23<- hh%>%filter(survey_year== '2023')

worker_list_23<- list(hh=hh_23, person= workers_23)
```

```{r}
workplace_gender <- summarize_weighted(hts_data= worker_list_23,
                               summarize_var = 'workplace',
                               summarize_by = 'gender_grp',
                               id_cols=c('hh_id', 'person_id'),
                               wt_cols=c('hh_weight','person_weight'),
                               wtname="person_weight"
                               )

```
## Visualize
```{r}

workplace_gender_summary<-workplace_gender$summary$wtd
static_bar_chart(workplace_gender_summary, y='workplace', x='prop', fill='gender_grp')

```

```{r}
summary_out_gender<-workplace_gender_summary%>%
        mutate(var_1_value=gender_grp, var_1_name= 'gender_grp',
         var_2_value= workplace, var_2_name= 'workplace')%>%
         select(-c(gender_grp, workplace))%>%mutate(geography='regional')

summary_out<-rbind(summary_out_gender, summary_out)
```



```{r}
workplace_income <- summarize_weighted(hts_data= worker_list_23,
                               summarize_var = 'workplace',
                               summarize_by = 'hhincome_broad',
                               id_cols=c('hh_id', 'person_id'),
                               wt_cols=c('hh_weight','person_weight'),
                               wtname="person_weight"
                               )

```
## Visualize
```{r}

workplace_income_summary<-workplace_income$summary$wtd%>%
  mutate(hhincome_broad=factor(hhincome_broad,
levels=c('Under $25,000','$25,000-$49,999','$50,000-$74,999',
'$75,000-$99,999','$100,000 or more','$100,000-$199,000','$200,000 or more','Prefer not to answer',
'Missing: Skip Logic')))

static_bar_chart(workplace_income_summary, y='workplace', x='prop', fill='hhincome_broad', color='pgnobgy_10')

```

```{r}
summary_out_income<-workplace_income_summary%>%
        mutate(var_1_value=hhincome_broad, var_1_name= 'hhincome_broad',
         var_2_value= workplace, var_2_name= 'workplace')%>%
         select(-c(hhincome_broad, workplace))%>%mutate(geography='regional')

summary_out<-rbind(summary_out_income, summary_out)
```

# telework time and telework frequency were asked to substantially different groups and in
# different ways comparing 2017/2019 to 2021/203; this will have to be worked through





# Summaries from person table:
# workplace by survey year
# 2023
# workplace by gender
# workplace by hhincome


# regional


for the subset of people who do sometimes go to a work outside home
```{r}
workers<-person%>%filter(!telecommute_freq_simple %in% c('Missing: Skip logic', "Missing: Skip Logic"))%>%drop_na(telecommute_freq_simple)
worker_list<-list(person=workers)

```

```{r}

telecommute_freq_simple <- summarize_weighted(hts_data= worker_list,
                               summarize_var = 'telecommute_freq_simple',
                               summarize_by = 'survey_year',
                               id_cols=c('person_id'),
                               wt_cols=c('person_weight'),
                               wtname= 'person_weight'
                               )

```
## Visualize

should we filter to people who do not always work from home?

# in 2019, this was asked of people with jobs
If commute_freq is not 6-7 days a week
How many days <do you/does name> work from home or telework (instead of going to work that day)?


# in 2021
How many days worked from home or teleworked last week (instead of going to work that day)?in 2021, this was asked of people if workplace = fixed/varied/telecommute some days
if workplace = fixed/varied/telecommute some days
How many days worked from home or teleworked last week (instead of going to work that day)?
Programmer: Dropdown menu with the following options: 
o	5+ days 
o	3-4 days 
o	1-2 days 


in2023

If commute_freq is not 6-7 days a week
How many days <do you/does name> work from home or telework (instead of going to work that day)?
6-7 days a week
5 days a week
4 days a week
3 days a week
2 days a week
1 day a week
1-3 days a month
Less than monthly
Never hide if job_type is Work ONLY from home or remotely (telework, self-employed)






```{r}

telecommute_freq_simple_summary<-telecommute_freq_simple$summary$wtd
static_bar_chart(telecommute_freq_simple_summary, y='telecommute_freq_simple', x='prop', fill='survey_year')

```
# to do: generalize, functionalize, just making it work for now;
```{r}
# make a generalized dataframe to store the outputs



summary_out<-telecommute_freq_simple_summary%>%
        mutate(var_1_value=survey_year, var_1_name= 'survey_year',
         var_2_value= telecommute_freq_simple, var_2_name= 'telecommute_freq_simple')%>%
         select(-c(survey_year, telecommute_freq_simple))%>%mutate(geography='regional')



```




2023 only by gender
```{r}
workers_23<-workers%>%filter(survey_year =='2023')
hh_23<- hh%>%filter(survey_year== '2023')

worker_list_23<- list(hh=hh_23, person= workers_23)
```

```{r}
telecommute_freq_simple_gender <- summarize_weighted(hts_data= worker_list_23,
                               summarize_var = 'telecommute_freq_simple',
                               summarize_by = 'gender_grp',
                               id_cols=c('hh_id', 'person_id'),
                               wt_cols=c('hh_weight','person_weight'),
                               wtname="person_weight"
                               )

```
## Visualize
```{r}

telecommute_freq_simple_gender_summary<-telecommute_freq_simple_gender$summary$wtd
static_bar_chart(telecommute_freq_simple_gender_summary, y='telecommute_freq_simple', x='prop', fill='gender_grp')

```

```{r}
summary_out_gender<-telecommute_freq_simple_gender_summary%>%
        mutate(var_1_value=gender_grp, var_1_name= 'gender_grp',
         var_2_value= telecommute_freq_simple, var_2_name= 'telecommute_freq_simple')%>%
         select(-c(gender_grp, telecommute_freq_simple))%>%mutate(geography='regional')

summary_out<-rbind(summary_out_gender, summary_out)
```



```{r}
telecommute_freq_simple_income <- summarize_weighted(hts_data= worker_list_23,
                               summarize_var = 'telecommute_freq_simple',
                               summarize_by = 'hhincome_broad',
                               id_cols=c('hh_id', 'person_id'),
                               wt_cols=c('hh_weight','person_weight'),
                               wtname="person_weight"
                               )

```
## Visualize
```{r}

telecommute_freq_simple_income_summary<-telecommute_freq_simple_income$summary$wtd%>%
  mutate(hhincome_broad=factor(hhincome_broad,
levels=c('Under $25,000','$25,000-$49,999','$50,000-$74,999',
'$75,000-$99,999','$100,000 or more','$100,000-$199,000','$200,000 or more','Prefer not to answer',
'Missing: Skip Logic')))

static_bar_chart(telecommute_freq_simple_income_summary, y='telecommute_freq_simple', x='prop', fill='hhincome_broad', color='pgnobgy_10')

```

```{r}
summary_out_income<-telecommute_freq_simple_income_summary%>%
        mutate(var_1_value=hhincome_broad, var_1_name= 'hhincome_broad',
         var_2_value= telecommute_freq_simple, var_2_name= 'telecommute_freq_simple')%>%
         select(-c(hhincome_broad, telecommute_freq_simple))%>%mutate(geography='regional')

summary_out<-rbind(summary_out_income, summary_out)
```



```{r}

hh_person_trip_list<-list(hh=hh, person=person, trip=trip)

```

```{r}
#some how a duplicate snuck into the variable list not sure how
variable_list<-variable_list%>%distinct(variable, .keep_all=TRUE)
```

# regional
```{r}

mode <- summarize_weighted(hts_data= hh_person_trip_list,
                               summarize_var = 'mode_simple',
                               summarize_by = 'survey_year',
                               id_cols=c('hh_id', 'person_id', 'trip_id'),
                               wt_cols=c('hh_weight', 'person_weight', 'trip_weight'),
                               wtname= 'trip_weight'
                               )

```
## Visualize
```{r}

mode_summary<-mode$summary$wtd
static_bar_chart(mode_summary, y='mode_simple', x='prop', fill='survey_year')

```
# to do: generalize, functionalize, just making it work for now;
```{r}
# make a generalized dataframe to store the outputs



summary_out<-mode_summary%>%
        mutate(var_1_value=survey_year, var_1_name= 'survey_year',
         var_2_value= mode_simple, var_2_name= 'mode_simple')%>%
         select(-c(survey_year, mode_simple))%>%mutate(geography='regional')



```




2023 only by gender
```{r}
trip_23<-trip%>%filter(survey_year =='2023')
hh_23<- hh%>%filter(survey_year== '2023')
person_23<-person%>%filter(survey_year=='2023')

data_list_23<- list(hh=hh_23, person= person_23, trip=trip_23)
```

```{r}
mode_gender <- summarize_weighted(hts_data= hh_person_trip_list,
                               summarize_var = 'mode_simple',
                               summarize_by = 'gender_grp',
                               id_cols=c('hh_id', 'person_id', 'trip_id'),
                               wt_cols=c('hh_weight', 'person_weight', 'trip_weight'),
                               wtname= 'trip_weight'
                               )

```
## Visualize
```{r}

mode_gender_summary<-mode_gender$summary$wtd
static_bar_chart(mode_gender_summary, y='mode_simple', x='prop', fill='gender_grp')

```

```{r}
summary_out_gender<-mode_gender_summary%>%
        mutate(var_1_value=gender_grp, var_1_name= 'gender_grp',
         var_2_value= mode_simple, var_2_name= 'mode_simple')%>%
         select(-c(gender_grp, mode_simple))%>%mutate(geography='regional')

summary_out<-rbind(summary_out_gender, summary_out)
```



```{r}
mode_income <- summarize_weighted(hts_data= hh_person_trip_list,
                               summarize_var = 'mode_simple',
                               summarize_by = 'hhincome_broad',
                               id_cols=c('hh_id', 'person_id', 'trip_id'),
                               wt_cols=c('hh_weight', 'person_weight', 'trip_weight'),
                               wtname= 'trip_weight'
                               )

```
## Visualize
```{r}

mode_income_summary<-mode_income$summary$wtd
static_bar_chart(mode_income_summary, y='mode_simple', x='prop', fill='hhincome_broad')

```

```{r}
summary_out_income<-mode_income_summary%>%
        mutate(var_1_value=hhincome_broad, var_1_name= 'hhincome_broad',
         var_2_value= mode_simple, var_2_name= 'mode_simple')%>%
         select(-c(hhincome_broad, mode_simple))%>%mutate(geography='regional')

summary_out<-rbind(summary_out_income, summary_out)
```


## Visualize
```{r}

mode_income_summary<-mode_income$summary$wtd%>%
  mutate(hhincome_broad=factor(hhincome_broad,
levels=c('Under $25,000','$25,000-$49,999','$50,000-$74,999',
'$75,000-$99,999','$100,000 or more','$100,000-$199,000','$200,000 or more','Prefer not to answer',
'Missing: Skip Logic')))

static_bar_chart(mode_income_summary, y='mode_simple', x='prop', fill='hhincome_broad', color='pgnobgy_10')

```



commute_freq by 
